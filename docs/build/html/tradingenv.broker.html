
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>tradingenv.broker package &#8212; tradingenv 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="tradingenv package" href="tradingenv.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="tradingenv-broker-package">
<h1>tradingenv.broker package<a class="headerlink" href="#tradingenv-broker-package" title="Permalink to this headline">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-tradingenv.broker.allocation">
<span id="tradingenv-broker-allocation-module"></span><h2>tradingenv.broker.allocation module<a class="headerlink" href="#module-tradingenv.broker.allocation" title="Permalink to this headline">¶</a></h2>
<p>Provides an extented python dictionary with handy methods when the dict
is mapping contracts to quantities (either nr of contracts of portfolio weight).</p>
<dl class="py class">
<dt class="sig sig-object py" id="tradingenv.broker.allocation.NrContracts">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tradingenv.broker.allocation.</span></span><span class="sig-name descname"><span class="pre">NrContracts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapping</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><span class="pre">tradingenv.contracts.AbstractContract</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><span class="pre">tradingenv.contracts.AbstractContract</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/allocation.html#NrContracts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.allocation.NrContracts" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tradingenv.broker.allocation._Allocation</span></code></p>
<p>A dictionary mapping contracts to number of contracts.</p>
<p>To initialize allocation you need to pass either ‘mapping’ OR
‘keys’ and ‘values’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mapping</strong> – A dictionary mapping instances of AbstractContract to a float
representing the target allocation expressed in a whatever unit of
measurement (e.g. weight or number of contracts).</p></li>
<li><p><strong>keys</strong> – A sequence of AbstractContract instances, representing the keys of
the dictionary to be constructed.</p></li>
<li><p><strong>values</strong> – A sequence of floats, representing the values of the dictionary
to be constructed.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="tradingenv.broker.allocation.Weights">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tradingenv.broker.allocation.</span></span><span class="sig-name descname"><span class="pre">Weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapping</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><span class="pre">tradingenv.contracts.AbstractContract</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><span class="pre">tradingenv.contracts.AbstractContract</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/allocation.html#Weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.allocation.Weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tradingenv.broker.allocation._Allocation</span></code></p>
<p>A dictionary mapping contracts to portfolio weight.</p>
<p>To initialize allocation you need to pass either ‘mapping’ OR
‘keys’ and ‘values’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mapping</strong> – A dictionary mapping instances of AbstractContract to a float
representing the target allocation expressed in a whatever unit of
measurement (e.g. weight or number of contracts).</p></li>
<li><p><strong>keys</strong> – A sequence of AbstractContract instances, representing the keys of
the dictionary to be constructed.</p></li>
<li><p><strong>values</strong> – A sequence of floats, representing the values of the dictionary
to be constructed.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-tradingenv.broker.broker">
<span id="tradingenv-broker-broker-module"></span><h2>tradingenv.broker.broker module<a class="headerlink" href="#module-tradingenv.broker.broker" title="Permalink to this headline">¶</a></h2>
<p>This module provides the core logic to perform portfolio _rebalancing.
Holdings (cash and contracts) are held in a Brokerage account and historical
_rebalancing are keep in TrackRecord.</p>
<dl class="py class">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tradingenv.broker.broker.</span></span><span class="sig-name descname"><span class="pre">Broker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exchange:</span> <span class="pre">tradingenv.exchange.Exchange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_currency:</span> <span class="pre">tradingenv.contracts.Cash</span> <span class="pre">=</span> <span class="pre">Cash(USD)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deposit:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">100.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fees:</span> <span class="pre">tradingenv.broker.fees.IBrokerFees</span> <span class="pre">=</span> <span class="pre">&lt;tradingenv.broker.fees.BrokerFees</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">1e-07</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/broker.html#Broker"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.broker.Broker" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>This class allows to simulate a sequence of _rebalancing requests.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker._holdings_margins">
<span class="sig-name descname"><span class="pre">_holdings_margins</span></span><a class="headerlink" href="#tradingenv.broker.broker.Broker._holdings_margins" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary mapping contracts to margins deposited at the clearing
house, e.g. when buying derivatives products such as futures.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>Dict[<a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract">AbstractContract</a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)">float</a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker._holdings_quantity">
<span class="sig-name descname"><span class="pre">_holdings_quantity</span></span><a class="headerlink" href="#tradingenv.broker.broker.Broker._holdings_quantity" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary mapping contracts to number of contracts held now.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>Dict[<a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract">AbstractContract</a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)">float</a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker.track_record">
<span class="sig-name descname"><span class="pre">track_record</span></span><a class="headerlink" href="#tradingenv.broker.broker.Broker.track_record" title="Permalink to this definition">¶</a></dt>
<dd><p>Keeps track of historical _rebalancing request.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#tradingenv.broker.track_record.TrackRecord" title="tradingenv.broker.track_record.TrackRecord">TrackRecord</a></p>
</dd>
</dl>
</dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>exchange</strong> (<a class="reference internal" href="tradingenv.html#tradingenv.exchange.Exchange" title="tradingenv.exchange.Exchange"><em>Exchange</em></a>) – An exchanged used to retrieve market prices and conditions to
execute _rebalancing requests and trade accordingly.</p></li>
<li><p><strong>base_currency</strong> (<a class="reference internal" href="tradingenv.html#tradingenv.contracts.Cash" title="tradingenv.contracts.Cash"><em>Cash</em></a>) – Base currency.</p></li>
<li><p><strong>deposit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – Initial deposit, 100 units of base currency by default.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker.accrued_interest">
<span class="sig-name descname"><span class="pre">accrued_interest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">now</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.11)"><span class="pre">datetime.datetime</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">accrue</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a></span></span><a class="reference internal" href="_modules/tradingenv/broker/broker.html#Broker.accrued_interest"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.broker.Broker.accrued_interest" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>now</strong> (<em>datetime</em>) – Current time, used to calculate how long it has passed since the
last time that interest rates were deposited or charged.</p></li>
<li><p><strong>accrue</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – If True, the interest rate will be accrued, i.e. charged if
negative or deposited if positive. The interest rate applied is
determined by Broker.fees.interest_rate.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>No interest rate paid on margins. This is a realistic conservative
assumption (e.g. Interactive Brokers does not pay interest rates on
margins and financial instrument cannot be deposited as _margin).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>Amount of interest rate owed (either positive or negative) since</em></p></li>
<li><p><em>when if was last deposited/charged from the account’s holdings.</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker.context">
<span class="sig-name descname"><span class="pre">context</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#tradingenv.broker.broker.Context" title="tradingenv.broker.broker.Context"><span class="pre">tradingenv.broker.broker.Context</span></a></span></span><a class="reference internal" href="_modules/tradingenv/broker/broker.html#Broker.context"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.broker.Broker.context" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker.holdings_margins">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">holdings_margins</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><span class="pre">tradingenv.contracts.AbstractContract</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#tradingenv.broker.broker.Broker.holdings_margins" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker.holdings_quantity">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">holdings_quantity</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><span class="pre">tradingenv.contracts.AbstractContract</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#tradingenv.broker.broker.Broker.holdings_quantity" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker.holdings_values">
<span class="sig-name descname"><span class="pre">holdings_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'notional'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><span class="pre">tradingenv.contracts.AbstractContract</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/tradingenv/broker/broker.html#Broker.holdings_values"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.broker.Broker.holdings_values" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns np.array with state of all positions within the portfolio
(cash included) in base currency. The array has as many entries as
traded contracts.
Notional values, so transaction_price * multiplier.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker.holdings_weights">
<span class="sig-name descname"><span class="pre">holdings_weights</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><span class="pre">tradingenv.contracts.AbstractContract</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/tradingenv/broker/broker.html#Broker.holdings_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.broker.Broker.holdings_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Relative weights of the notional traded value over NLV.
Returns current weights of the portfolio as positions values
(including market spread) divided by the net liquidation state of the
account (including market spread).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker.marking_to_market">
<span class="sig-name descname"><span class="pre">marking_to_market</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><span class="pre">tradingenv.contracts.AbstractContract</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><span class="pre">tradingenv.contracts.AbstractContract</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/broker.html#Broker.marking_to_market"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.broker.Broker.marking_to_market" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>contract</strong> (<em>Union</em><em>[</em><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><em>AbstractContract</em></a><em>, </em><em>Sequence</em><em>[</em><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><em>AbstractContract</em></a><em>]</em><em>]</em>) – An optional contract or sequence of contracts to for which
marking-to-market has to be performed. If blank, all contracts will
be assumed to be updated.</p>
</dd>
</dl>
<p class="rubric">References</p>
<p><a class="reference external" href="https://www.cmegroup.com/education/courses/introduction-to-futures/mark-to-market.html">https://www.cmegroup.com/education/courses/introduction-to-futures/mark-to-market.html</a>
<a class="reference external" href="https://www.cmegroup.com/education/courses/introduction-to-futures/margin-know-what-is-needed.html">https://www.cmegroup.com/education/courses/introduction-to-futures/margin-know-what-is-needed.html</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker.net_liquidation_value">
<span class="sig-name descname"><span class="pre">net_liquidation_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raise_if_broke</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a></span></span><a class="reference internal" href="_modules/tradingenv/broker/broker.html#Broker.net_liquidation_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.broker.Broker.net_liquidation_value" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>raise_if_broke</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – An EndOfEpisodeError will be raised if the notional liquidation
value of the account is non-positive.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>The net liquidation value of the account pricing long (short) position</em></p></li>
<li><p><em>using bid (ask) prices.</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker.rebalance">
<span class="sig-name descname"><span class="pre">rebalance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rebalancing</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#tradingenv.broker.rebalancing.Rebalancing" title="tradingenv.broker.rebalancing.Rebalancing"><span class="pre">tradingenv.broker.rebalancing.Rebalancing</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/broker.html#Broker.rebalance"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.broker.Broker.rebalance" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a _rebalancing object, execute all trades needed to perform the
_rebalancing.</p>
<p>The _rebalancing logic is slit between Rebalancing and Broker.
Rebalancing is responsible for calculating (but not executing) the
trading instructions (i.e. a list of trades), wheres Broker is
responsible for anything else (i.e. pre-processing, execution and
post-processing).
This design allows to optionally compute the trades for a variety of
_rebalancing objects and see what the trades would be, without
performing any _rebalancing. Also, the separation of concerns between
calculating the trades and execution the trades makes it easier to
test the code.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Broker.transact">
<span class="sig-name descname"><span class="pre">transact</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trade</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#tradingenv.broker.trade.Trade" title="tradingenv.broker.trade.Trade"><span class="pre">tradingenv.broker.trade.Trade</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/broker.html#Broker.transact"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.broker.Broker.transact" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>trade</strong> (<a class="reference internal" href="#tradingenv.broker.trade.Trade" title="tradingenv.broker.trade.Trade"><em>Trade</em></a>) – A trade instance to be executed.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Transacting in long lasting positions might lead to numerical errors in
the order of ~1e-15. It’s a design choice not to deal with such errors
because for prices –&gt; +inf, _holdings_quantity –&gt; 0 &lt; 1e-15. In other
words, we don’t deal with such numerical errors to avoid unexpected
side effects when asset prices are relatively too high.
<a class="reference external" href="https://floating-point-gui.de/basic/">https://floating-point-gui.de/basic/</a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="tradingenv.broker.broker.Context">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tradingenv.broker.broker.</span></span><span class="sig-name descname"><span class="pre">Context</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nlv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nr_contracts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">margins</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/broker.html#Context"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.broker.Context" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="tradingenv.broker.broker.EndOfEpisodeError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tradingenv.broker.broker.</span></span><span class="sig-name descname"><span class="pre">EndOfEpisodeError</span></span><a class="reference internal" href="_modules/tradingenv/broker/broker.html#EndOfEpisodeError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.broker.EndOfEpisodeError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#Exception" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></a></p>
<p>Raised when the net liquidation state of the account goes below zero.
This exception will trigger an end of episode.</p>
</dd></dl>

</section>
<section id="module-tradingenv.broker.fees">
<span id="tradingenv-broker-fees-module"></span><h2>tradingenv.broker.fees module<a class="headerlink" href="#module-tradingenv.broker.fees" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="tradingenv.broker.fees.BrokerFees">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tradingenv.broker.fees.</span></span><span class="sig-name descname"><span class="pre">BrokerFees</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">markup:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interest_rate:</span> <span class="pre">tradingenv.contracts.Rate</span> <span class="pre">=</span> <span class="pre">Rate(FED</span> <span class="pre">funds</span> <span class="pre">rate)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proportional:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/fees.html#BrokerFees"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.fees.BrokerFees" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#tradingenv.broker.fees.IBrokerFees" title="tradingenv.broker.fees.IBrokerFees"><code class="xref py py-class docutils literal notranslate"><span class="pre">tradingenv.broker.fees.IBrokerFees</span></code></a></p>
<p>No broker fees of any sort will be applied when using this class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>markup</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – A non-negative CAGR, zero by default. This mark-up is the profit
of the broker when applying the interest rate to idle cash and
loans. For example, if interest_rate is 0.03 (3%) and fees=0.01
(1%), CAGR on idle cash will be 2% and cost of loans will be 4%.</p></li>
<li><p><strong>interest_rate</strong> (<a class="reference internal" href="tradingenv.html#tradingenv.contracts.Rate" title="tradingenv.contracts.Rate"><em>Rate</em></a>) – This interest rate is used to: (1) generate a positive stream of
cash flows on idle cash (e.g. when the portfolio is not fully
invested) and (2) generate a negative stream of cash flows on
loans (e.g. borrowed cash to pay in a leveraged portfolio of ETFs).
By default, this is Rate(‘FED funds rate’) and it’s expressed in
terms of compounded annual growth rate (CAGR).</p></li>
<li><p><strong>proportional</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – Broker fees to be applied to the notional traded value of the
security. E.g. if 0.01 (1%) mean that 1 USD is paid for every
100 USD traded.</p></li>
<li><p><strong>fixed</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – Fixed broker fees to be applied to each trade, regardless the
notional traded value of trade.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.fees.BrokerFees.commissions">
<span class="sig-name descname"><span class="pre">commissions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trade</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#tradingenv.broker.trade.Trade" title="tradingenv.broker.trade.Trade"><span class="pre">tradingenv.broker.trade.Trade</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a></span></span><a class="reference internal" href="_modules/tradingenv/broker/fees.html#BrokerFees.commissions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.fees.BrokerFees.commissions" title="Permalink to this definition">¶</a></dt>
<dd><p>Zero fees.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="tradingenv.broker.fees.IBrokerFees">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tradingenv.broker.fees.</span></span><span class="sig-name descname"><span class="pre">IBrokerFees</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">markup:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interest_rate:</span> <span class="pre">tradingenv.contracts.Rate</span> <span class="pre">=</span> <span class="pre">Rate(FED</span> <span class="pre">funds</span> <span class="pre">rate)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proportional:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/fees.html#IBrokerFees"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.fees.IBrokerFees" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.ABC" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABC</span></code></a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>markup</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – A non-negative CAGR, zero by default. This mark-up is the profit
of the broker when applying the interest rate to idle cash and
loans. For example, if interest_rate is 0.03 (3%) and fees=0.01
(1%), CAGR on idle cash will be 2% and cost of loans will be 4%.</p></li>
<li><p><strong>interest_rate</strong> (<a class="reference internal" href="tradingenv.html#tradingenv.contracts.Rate" title="tradingenv.contracts.Rate"><em>Rate</em></a>) – This interest rate is used to: (1) generate a positive stream of
cash flows on idle cash (e.g. when the portfolio is not fully
invested) and (2) generate a negative stream of cash flows on
loans (e.g. borrowed cash to pay in a leveraged portfolio of ETFs).
By default, this is Rate(‘FED funds rate’) and it’s expressed in
terms of compounded annual growth rate (CAGR).</p></li>
<li><p><strong>proportional</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – Broker fees to be applied to the notional traded value of the
security. E.g. if 0.01 (1%) mean that 1 USD is paid for every
100 USD traded.</p></li>
<li><p><strong>fixed</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – Fixed broker fees to be applied to each trade, regardless the
notional traded value of trade.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.fees.IBrokerFees.commissions">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">commissions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trade</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#tradingenv.broker.trade.Trade" title="tradingenv.broker.trade.Trade"><span class="pre">tradingenv.broker.trade.Trade</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a></span></span><a class="reference internal" href="_modules/tradingenv/broker/fees.html#IBrokerFees.commissions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.fees.IBrokerFees.commissions" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns total broker fees.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="tradingenv.broker.fees.InteractiveBrokersFees">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tradingenv.broker.fees.</span></span><span class="sig-name descname"><span class="pre">InteractiveBrokersFees</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">markup:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interest_rate:</span> <span class="pre">tradingenv.contracts.Rate</span> <span class="pre">=</span> <span class="pre">Rate(FED</span> <span class="pre">funds</span> <span class="pre">rate)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proportional:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/fees.html#InteractiveBrokersFees"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.fees.InteractiveBrokersFees" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#tradingenv.broker.fees.IBrokerFees" title="tradingenv.broker.fees.IBrokerFees"><code class="xref py py-class docutils literal notranslate"><span class="pre">tradingenv.broker.fees.IBrokerFees</span></code></a></p>
<p>Replicate Interactive Broker commisions.</p>
<p class="rubric">References</p>
<p><a class="reference external" href="https://www.interactivebrokers.com/en/index.php?f=1590">https://www.interactivebrokers.com/en/index.php?f=1590</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>markup</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – A non-negative CAGR, zero by default. This mark-up is the profit
of the broker when applying the interest rate to idle cash and
loans. For example, if interest_rate is 0.03 (3%) and fees=0.01
(1%), CAGR on idle cash will be 2% and cost of loans will be 4%.</p></li>
<li><p><strong>interest_rate</strong> (<a class="reference internal" href="tradingenv.html#tradingenv.contracts.Rate" title="tradingenv.contracts.Rate"><em>Rate</em></a>) – This interest rate is used to: (1) generate a positive stream of
cash flows on idle cash (e.g. when the portfolio is not fully
invested) and (2) generate a negative stream of cash flows on
loans (e.g. borrowed cash to pay in a leveraged portfolio of ETFs).
By default, this is Rate(‘FED funds rate’) and it’s expressed in
terms of compounded annual growth rate (CAGR).</p></li>
<li><p><strong>proportional</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – Broker fees to be applied to the notional traded value of the
security. E.g. if 0.01 (1%) mean that 1 USD is paid for every
100 USD traded.</p></li>
<li><p><strong>fixed</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – Fixed broker fees to be applied to each trade, regardless the
notional traded value of trade.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.fees.InteractiveBrokersFees.commissions">
<span class="sig-name descname"><span class="pre">commissions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trade</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#tradingenv.broker.trade.Trade" title="tradingenv.broker.trade.Trade"><span class="pre">tradingenv.broker.trade.Trade</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a></span></span><a class="reference internal" href="_modules/tradingenv/broker/fees.html#InteractiveBrokersFees.commissions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.fees.InteractiveBrokersFees.commissions" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns total broker fees.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-tradingenv.broker.rebalancing">
<span id="tradingenv-broker-rebalancing-module"></span><h2>tradingenv.broker.rebalancing module<a class="headerlink" href="#module-tradingenv.broker.rebalancing" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="tradingenv.broker.rebalancing.Rebalancing">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tradingenv.broker.rebalancing.</span></span><span class="sig-name descname"><span class="pre">Rebalancing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contracts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><span class="pre">tradingenv.contracts.AbstractContract</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">measure</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'weight'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">absolute</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fractional</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">margin</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.11)"><span class="pre">datetime.datetime</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/rebalancing.html#Rebalancing"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.rebalancing.Rebalancing" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Private class returned by PortfolioSpace._make_rebalancing_request and
passed to RebalancingResponse during its initialization.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>contracts</strong> – A sequence of contracts. The i-th contract is associated with the
i-th element in ‘allocation’.</p></li>
<li><p><strong>allocation</strong> – A sequence of target portfolio allocations of the _rebalancing.
The i-th allocation is associated with the i-th element
in ‘contracts’. The representation of the values in the sequence
depends on the parameter ‘kind’.</p></li>
<li><p><strong>measure</strong> – The unit of measurement of the parameter ‘allocation’. If:
- ‘weight’: a 0.2 would mean 20% of the net liquidation value of
the current portfolio.
- ‘nr-contracts’: a 21 would mean 21 contracts.</p></li>
<li><p><strong>absolute</strong> – If True (default), ‘allocation’ is assumed to represents the
desired target allocation. For example, if
allocation={ETF(SPY): 0.03} and measure=’weight’, then
the desired _rebalancing will result in an allocation in ETF(SPY)
corresponding to 3% of the net liquidation value and the remaining
97% in cash.
If False, ‘allocation’ is assumed to represent the desired change
from the current allocation. or example, if
allocation={ETF(SPY): 0.03} and measure=’weight’, then
the desired _rebalancing will result in the previously held
portfolio with 3% less of cash and 3% more of ETF(SPY).</p></li>
<li><p><strong>fractional</strong> – True by default. If false, decimals will be ignored from every
element of ‘allocation’.</p></li>
<li><p><strong>margin</strong> – A non-negative float. Rebalancing of positions which are not at
least different by ‘_margin’ in absolute value, will not be
executed. Setting a small positive value (e.g. 0.02==2%) might be
a good practice to reduce transaction costs.
Skip trade if the absolute weight imbalance is below the margin
AND the target weight is different from zero. The latter condition
allows to liquidate a position in the situation where we hold in
the portfolio a contract with a tiny weight below the margin.</p></li>
<li><p><strong>time</strong> – Time of the _rebalancing request. Current time by default.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Target weights are applied to the net liquidation value of the account
before paying transaction costs to make the problem more trackable).
Therefore, in presence transaction costs, the amount of cash in the
broker account will be -x where x are the broker commissions paid.</p>
<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.rebalancing.Rebalancing.make_trades">
<span class="sig-name descname"><span class="pre">make_trades</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">broker</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#tradingenv.broker.broker.Broker" title="tradingenv.broker.broker.Broker"><span class="pre">tradingenv.broker.broker.Broker</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#tradingenv.broker.trade.Trade" title="tradingenv.broker.trade.Trade"><span class="pre">tradingenv.broker.trade.Trade</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/tradingenv/broker/rebalancing.html#Rebalancing.make_trades"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.rebalancing.Rebalancing.make_trades" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>broker</strong> – A broker instance that will be used e.g. to calculate the offset
between target _rebalancing and current holdings.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>A list of trade objects, recommended to perform the portfolio</em></p></li>
<li><p><em>_rebalancing.</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-tradingenv.broker.track_record">
<span id="tradingenv-broker-track-record-module"></span><h2>tradingenv.broker.track_record module<a class="headerlink" href="#module-tradingenv.broker.track_record" title="Permalink to this headline">¶</a></h2>
<p>TrackRecord stores historical _rebalancing execution performed by Broker.</p>
<dl class="py class">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tradingenv.broker.track_record.</span></span><span class="sig-name descname"><span class="pre">TrackRecord</span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Stores historical _rebalancing requests and _rebalancing.</p>
<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.cost_of_commissions">
<span class="sig-name descname"><span class="pre">cost_of_commissions</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.cost_of_commissions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.cost_of_commissions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.cost_of_spread">
<span class="sig-name descname"><span class="pre">cost_of_spread</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.cost_of_spread"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.cost_of_spread" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.fig_annual_returns">
<span class="sig-name descname"><span class="pre">fig_annual_returns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">&lt;Mock</span> <span class="pre">name='mock.graph_objs.Figure'</span> <span class="pre">id='140300342646128'&gt;</span></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.fig_annual_returns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.fig_annual_returns" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.fig_capital_asset_pricing_model">
<span class="sig-name descname"><span class="pre">fig_capital_asset_pricing_model</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">&lt;Mock</span> <span class="pre">name='mock.graph_objs.Figure'</span> <span class="pre">id='140300342646128'&gt;</span></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.fig_capital_asset_pricing_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.fig_capital_asset_pricing_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.fig_drawdown">
<span class="sig-name descname"><span class="pre">fig_drawdown</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">&lt;Mock</span> <span class="pre">name='mock.graph_objs.Figure'</span> <span class="pre">id='140300342646128'&gt;</span></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.fig_drawdown"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.fig_drawdown" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.fig_historical_portfolio_weights_actual">
<span class="sig-name descname"><span class="pre">fig_historical_portfolio_weights_actual</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">group_futures</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_rebalancing</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">&lt;Mock</span> <span class="pre">name='mock.graph_objs.Figure'</span> <span class="pre">id='140300342646128'&gt;</span></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.fig_historical_portfolio_weights_actual"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.fig_historical_portfolio_weights_actual" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.fig_historical_portfolio_weights_diff">
<span class="sig-name descname"><span class="pre">fig_historical_portfolio_weights_diff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">group_futures</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_rebalancing</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">&lt;Mock</span> <span class="pre">name='mock.graph_objs.Figure'</span> <span class="pre">id='140300342646128'&gt;</span></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.fig_historical_portfolio_weights_diff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.fig_historical_portfolio_weights_diff" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.fig_historical_portfolio_weights_target">
<span class="sig-name descname"><span class="pre">fig_historical_portfolio_weights_target</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">group_futures</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.fig_historical_portfolio_weights_target"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.fig_historical_portfolio_weights_target" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.fig_net_liquidation_value">
<span class="sig-name descname"><span class="pre">fig_net_liquidation_value</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">&lt;Mock</span> <span class="pre">name='mock.graph_objs.Figure'</span> <span class="pre">id='140300342646128'&gt;</span></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.fig_net_liquidation_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.fig_net_liquidation_value" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.fig_returns_distribution">
<span class="sig-name descname"><span class="pre">fig_returns_distribution</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.fig_returns_distribution"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.fig_returns_distribution" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.fig_transaction_costs">
<span class="sig-name descname"><span class="pre">fig_transaction_costs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">&lt;Mock</span> <span class="pre">name='mock.graph_objs.Figure'</span> <span class="pre">id='140300342646128'&gt;</span></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.fig_transaction_costs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.fig_transaction_costs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.load">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#tradingenv.broker.track_record.TrackRecord" title="tradingenv.broker.track_record.TrackRecord"><span class="pre">tradingenv.broker.track_record.TrackRecord</span></a></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.load" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.net_liquidation_value">
<span class="sig-name descname"><span class="pre">net_liquidation_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">before_rebalancing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">burn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Net</span> <span class="pre">liquidation</span> <span class="pre">value'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Date'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">&lt;Mock</span> <span class="pre">name='mock.DataFrame'</span> <span class="pre">id='140300342646224'&gt;</span></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.net_liquidation_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.net_liquidation_value" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>before_rebalancing</strong> – </p></li>
<li><p><strong>burn</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – Default is False (least surprise principle). If True, initial
checkpoints with no trades (i.e. when the portfolio is cash only)
will be discarded when calling TrackRecord.to_frame, unless
a burn argument is explicitly passed to TrackRecord.to_frame.</p></li>
<li><p><strong>name</strong> – </p></li>
<li><p><strong>index_name</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.save" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.to_excel">
<span class="sig-name descname"><span class="pre">to_excel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.to_excel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.to_excel" title="Permalink to this definition">¶</a></dt>
<dd><p>Export track record to excel.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.transaction_costs">
<span class="sig-name descname"><span class="pre">transaction_costs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">burn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Date'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cumulative</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">&lt;Mock</span> <span class="pre">name='mock.DataFrame'</span> <span class="pre">id='140300342646224'&gt;</span></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.transaction_costs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.transaction_costs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.weights_actual">
<span class="sig-name descname"><span class="pre">weights_actual</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">before_rebalancing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">burn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Portfolio</span> <span class="pre">weights</span> <span class="pre">actual'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Date'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregate_future_chain</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">&lt;Mock</span> <span class="pre">name='mock.DataFrame'</span> <span class="pre">id='140300342646224'&gt;</span></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.weights_actual"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.weights_actual" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecord.weights_target">
<span class="sig-name descname"><span class="pre">weights_target</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">burn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Portfolio</span> <span class="pre">weights</span> <span class="pre">target'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Date'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregate_future_chain</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">&lt;Mock</span> <span class="pre">name='mock.DataFrame'</span> <span class="pre">id='140300342646224'&gt;</span></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecord.weights_target"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecord.weights_target" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecordComparison">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tradingenv.broker.track_record.</span></span><span class="sig-name descname"><span class="pre">TrackRecordComparison</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">track_records</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#tradingenv.broker.track_record.TrackRecord" title="tradingenv.broker.track_record.TrackRecord"><span class="pre">tradingenv.broker.track_record.TrackRecord</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecordComparison"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecordComparison" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="tradingenv.broker.track_record.TrackRecordComparison.fig_net_liquidation_value">
<span class="sig-name descname"><span class="pre">fig_net_liquidation_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">logy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">&lt;Mock</span> <span class="pre">name='mock.graph_objs.Figure'</span> <span class="pre">id='140300342646128'&gt;</span></span></span><a class="reference internal" href="_modules/tradingenv/broker/track_record.html#TrackRecordComparison.fig_net_liquidation_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.track_record.TrackRecordComparison.fig_net_liquidation_value" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-tradingenv.broker.trade">
<span id="tradingenv-broker-trade-module"></span><h2>tradingenv.broker.trade module<a class="headerlink" href="#module-tradingenv.broker.trade" title="Permalink to this headline">¶</a></h2>
<p>Execution details of a single trade.</p>
<dl class="py class">
<dt class="sig sig-object py" id="tradingenv.broker.trade.Trade">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tradingenv.broker.trade.</span></span><span class="sig-name descname"><span class="pre">Trade</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time:</span> <span class="pre">datetime.datetime</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract:</span> <span class="pre">tradingenv.contracts.AbstractContract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantity:</span> <span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bid_price:</span> <span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ask_price:</span> <span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">broker_fees:</span> <span class="pre">tradingenv.broker.fees.IBrokerFees</span> <span class="pre">=</span> <span class="pre">&lt;tradingenv.broker.fees.BrokerFees</span> <span class="pre">object&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingenv/broker/trade.html#Trade"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tradingenv.broker.trade.Trade" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Execution details of a single trade. This class is instanced by
RebalancingResponse.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.trade.Trade.acq_price">
<span class="sig-name descname"><span class="pre">acq_price</span></span><a class="headerlink" href="#tradingenv.broker.trade.Trade.acq_price" title="Permalink to this definition">¶</a></dt>
<dd><p>Average acquisition or liquidation price across all lots to execute
the trade. By default, there is no market impact nor slippage.
Therefore, avg_price corresponds to the bid price (ask price) in case
of buy (sell).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)">float</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.trade.Trade.cost_of_cash">
<span class="sig-name descname"><span class="pre">cost_of_cash</span></span><a class="headerlink" href="#tradingenv.broker.trade.Trade.cost_of_cash" title="Permalink to this definition">¶</a></dt>
<dd><p>Cash to be paid (earned) upfront to buy (sell) the contract.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)">float</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.trade.Trade.cost_of_commissions">
<span class="sig-name descname"><span class="pre">cost_of_commissions</span></span><a class="headerlink" href="#tradingenv.broker.trade.Trade.cost_of_commissions" title="Permalink to this definition">¶</a></dt>
<dd><p>Broker commissions paid when transacting.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)">float</a></p>
</dd>
</dl>
</dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time</strong> (<em>datetime</em>) – Execution time of the trade.</p></li>
<li><p><strong>contract</strong> (<a class="reference internal" href="tradingenv.html#tradingenv.contracts.AbstractContract" title="tradingenv.contracts.AbstractContract"><em>AbstractContract</em></a>) – Traded contract.</p></li>
<li><p><strong>quantity</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – Traded quantity. A negative number denotes a sell, liquidation or
short-selling.</p></li>
<li><p><strong>bid_price</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – Bid price in the limit order book of the contract. Bid price must
be non-greater then the ask price.</p></li>
<li><p><strong>ask_price</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – Ask price in the limit order book of the contract. Ask price must
be non.smaller than the bid price.</p></li>
<li><p><strong>broker_fees</strong> (<a class="reference internal" href="#tradingenv.broker.fees.IBrokerFees" title="tradingenv.broker.fees.IBrokerFees"><em>IBrokerFees</em></a>) – An concrete implementation of AbstractBrokerFees,
responsible to calculate the total broker fees to be paid
for the trade.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="id0">
<span class="sig-name descname"><span class="pre">acq_price</span></span><a class="headerlink" href="#id0" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.trade.Trade.ask_price">
<span class="sig-name descname"><span class="pre">ask_price</span></span><a class="headerlink" href="#tradingenv.broker.trade.Trade.ask_price" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.trade.Trade.bid_price">
<span class="sig-name descname"><span class="pre">bid_price</span></span><a class="headerlink" href="#tradingenv.broker.trade.Trade.bid_price" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.trade.Trade.contract">
<span class="sig-name descname"><span class="pre">contract</span></span><a class="headerlink" href="#tradingenv.broker.trade.Trade.contract" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id1">
<span class="sig-name descname"><span class="pre">cost_of_cash</span></span><a class="headerlink" href="#id1" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id2">
<span class="sig-name descname"><span class="pre">cost_of_commissions</span></span><a class="headerlink" href="#id2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.trade.Trade.cost_of_spread">
<span class="sig-name descname"><span class="pre">cost_of_spread</span></span><a class="headerlink" href="#tradingenv.broker.trade.Trade.cost_of_spread" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.trade.Trade.notional">
<span class="sig-name descname"><span class="pre">notional</span></span><a class="headerlink" href="#tradingenv.broker.trade.Trade.notional" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.trade.Trade.quantity">
<span class="sig-name descname"><span class="pre">quantity</span></span><a class="headerlink" href="#tradingenv.broker.trade.Trade.quantity" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="tradingenv.broker.trade.Trade.time">
<span class="sig-name descname"><span class="pre">time</span></span><a class="headerlink" href="#tradingenv.broker.trade.Trade.time" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-tradingenv.broker">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-tradingenv.broker" title="Permalink to this headline">¶</a></h2>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="modules.html">tradingenv</a><ul>
  <li><a href="tradingenv.html">tradingenv package</a><ul>
      <li>Previous: <a href="tradingenv.html" title="previous chapter">tradingenv package</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">tradingenv.broker package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-tradingenv.broker.allocation">tradingenv.broker.allocation module</a></li>
<li><a class="reference internal" href="#module-tradingenv.broker.broker">tradingenv.broker.broker module</a></li>
<li><a class="reference internal" href="#module-tradingenv.broker.fees">tradingenv.broker.fees module</a></li>
<li><a class="reference internal" href="#module-tradingenv.broker.rebalancing">tradingenv.broker.rebalancing module</a></li>
<li><a class="reference internal" href="#module-tradingenv.broker.track_record">tradingenv.broker.track_record module</a></li>
<li><a class="reference internal" href="#module-tradingenv.broker.trade">tradingenv.broker.trade module</a></li>
<li><a class="reference internal" href="#module-tradingenv.broker">Module contents</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Federico Fontana.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/tradingenv.broker.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>